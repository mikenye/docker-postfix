#!/usr/bin/env bash
# shellcheck shell=bash

BODY_CHECKS_PCRE_FILE="/etc/postfix/body_checks.pcre"
BODY_CHECKS_PCRE_FILE_LOCAL="/etc/postfix/tables/body_checks.pcre"

# Remove existing client_access.cidr
rm "${BODY_CHECKS_PCRE_FILE}" > /dev/null 2>&1
touch "${BODY_CHECKS_PCRE_FILE}"

{
  # Import local entries into client_access.cidr
  if [ -f "${BODY_CHECKS_PCRE_FILE_LOCAL}" ]; then
    echo ""
    echo "## Entries from ${BODY_CHECKS_PCRE_FILE_LOCAL}"
    cat "${BODY_CHECKS_PCRE_FILE_LOCAL}"
    echo ""
  fi
} > "${BODY_CHECKS_PCRE_FILE}"

# No need to run postmap over PCRE files

# If postfix is running, update
if postfix status > /dev/null 2>&1; then
  postfix reload
fi
